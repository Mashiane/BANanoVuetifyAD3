!function(n,r){"object"==typeof exports&&"undefined"!=typeof module?r(exports,require("firebase/firestore"),require("rxjs"),require("rxjs/operators"),require("rxfire/firestore")):"function"==typeof define&&define.amd?define(["exports","firebase/firestore","rxjs","rxjs/operators","rxfire/firestore"],r):r(n.firesql={},n.firebase,n["*"],n["*"],n["*"])}(this,function(n,r,s,l,v){"use strict";var t,e,p=function(){return(p=Object.assign||function(n){for(var r,t=1,e=arguments.length;t<e;t++)for(var u in r=arguments[t])Object.prototype.hasOwnProperty.call(r,u)&&(n[u]=r[u]);return n}).apply(this,arguments)};function h(o,i,f,c){return new(f||(f=Promise))(function(n,r){function t(n){try{u(c.next(n))}catch(n){r(n)}}function e(n){try{u(c.throw(n))}catch(n){r(n)}}function u(r){r.done?n(r.value):new f(function(n){n(r.value)}).then(t,e)}u((c=c.apply(o,i||[])).next())})}function d(t,e){var u,o,i,n,f={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return n={next:r(0),throw:r(1),return:r(2)},"function"==typeof Symbol&&(n[Symbol.iterator]=function(){return this}),n;function r(r){return function(n){return function(r){if(u)throw new TypeError("Generator is already executing.");for(;f;)try{if(u=1,o&&(i=2&r[0]?o.return:r[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,r[1])).done)return i;switch(o=0,i&&(r=[2&r[0],i.value]),r[0]){case 0:case 1:i=r;break;case 4:return f.label++,{value:r[1],done:!1};case 5:f.label++,o=r[1],r=[0];continue;case 7:r=f.ops.pop(),f.trys.pop();continue;default:if(!(i=0<(i=f.trys).length&&i[i.length-1])&&(6===r[0]||2===r[0])){f=0;continue}if(3===r[0]&&(!i||r[1]>i[0]&&r[1]<i[3])){f.label=r[1];break}if(6===r[0]&&f.label<i[1]){f.label=i[1],i=r;break}if(i&&f.label<i[2]){f.label=i[2],f.ops.push(r);break}i[2]&&f.ops.pop(),f.trys.pop();continue}r=e.call(t,f)}catch(n){r=[6,n],o=0}finally{u=i=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,n])}}}function bu(n,r,t,e){this.message=n,this.expected=r,this.found=t,this.location=e,this.name="SyntaxError","function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,bu)}function u(){this.constructor=t}function y(on,o){o=void 0!==o?o:{};var n,fn={},r={start:Ee},t=Ee,cn="(",an=")",sn="`",i="/",f="!",c="=",e=">=",u=">",a="<=",s="<>",l="<",v="!=",p="+",h="-",ln="*",d="%",w='"',N="'",y="\\'",g='\\"',E="\\\\",b="\\/",m="\\b",O="\\f",S="\\n",T="\\r",I="\\t",A="\\u",x=".",R="null",C="true",_="false",vn="select",pn="from",j="as",L="union",hn="where",U="group",F="by",dn="order",yn="limit",M="asc",W="desc",gn="all",En="distinct",q="between",k="in",Y="is",D="like",H="contains",P="not",B="and",G="or",X="max",K="min",z="sum",V="avg",Z=",",Q=/^[^`]/,$=/^[A-Za-z_]/,J=/^[A-Za-z0-9_]/,nn=/^[^'\\\0-\x1F\x7F]/,rn=/^[^"\\\0-\x1F\x7F]/,tn=/^[0-9]/,en=/^[1-9]/,un=/^[0-9a-fA-F]/,bn=/^[eE]/,mn=/^[+\-]/,wn=/^[ \t\n\r]/,Nn=ae("(",!1),On=ae(")",!1),Sn=le("column_clause"),Tn=ae("`",!1),In=ae("/",!1),An=ae("!",!1),xn=ae("=",!1),Rn=ae(">=",!1),Cn=ae(">",!1),_n=ae("<=",!1),jn=ae("<>",!1),Ln=ae("<",!1),Un=ae("!=",!1),Fn=ae("+",!1),Mn=ae("-",!1),Wn=ae("*",!1),kn=ae("%",!1),Dn=se(["`"],!0,!1),Hn=se([["A","Z"],["a","z"],"_"],!1,!1),Pn=se([["A","Z"],["a","z"],["0","9"],"_"],!1,!1),Bn=ae('"',!1),Gn=ae("'",!1),qn=se(["'","\\",["\0",""],""],!0,!1),Yn=se(['"',"\\",["\0",""],""],!0,!1),Xn=ae("\\'",!1),Kn=ae('\\"',!1),zn=ae("\\\\",!1),Vn=ae("\\/",!1),Zn=ae("\\b",!1),Qn=ae("\\f",!1),$n=ae("\\n",!1),Jn=ae("\\r",!1),nr=ae("\\t",!1),rr=ae("\\u",!1),tr=le("LITERAL INT"),er=ae(".",!1),ur=le("NUMBER"),or=le("HEX"),ir=se(["e","E"],!1,!1),fr=se(["+","-"],!1,!1),cr=ae("NULL",!0),ar=ae("TRUE",!0),sr=ae("FALSE",!0),lr=ae("SELECT",!0),vr=ae("FROM",!0),pr=ae("AS",!0),hr=ae("UNION",!0),dr=ae("WHERE",!0),yr=ae("GROUP",!0),gr=ae("BY",!0),Er=ae("ORDER",!0),br=ae("LIMIT",!0),mr=ae("ASC",!0),wr=ae("DESC",!0),Nr=ae("DISTINCT",!0),Or=ae("BETWEEN",!0),Sr=ae("IN",!0),Tr=ae("IS",!0),Ir=ae("LIKE",!0),Ar=ae("CONTAINS",!0),xr=ae("NOT",!0),Rr=ae("AND",!0),Cr=ae("OR",!0),_r=ae("MAX",!0),jr=ae("MIN",!0),Lr=ae("SUM",!0),Ur=ae("AVG",!0),Fr=ae(",",!1),Mr=le("WHITE_SPACE"),Wr=function(n){return n},kr=function(n,r){for(var t=n,e=0;e<r.length;e++)t.n=r[e][3],t=t.n;return n},Dr=function(n){return n[2]},Hr=function(n,r,t,e,u,o,i){return{type:"select",distinct:n,columns:r,from:t,where:e,groupby:u,orderby:o,limit:i}},Pr=function(){return"*"},Br=function(n,r){return lu(n,r)},Gr=function(n,r){return{expr:n,as:r}},qr=function(n){return n},Yr=function(n){return n},Xr=function(n,r,t){return{db:r.db,parts:(Array.isArray(r)?r[1]:r).parts,as:t,group:!!n}},Kr=function(n){return{parts:n.map(function(n){return n[1]})}},zr=function(n){return n},Vr=function(n,r){var t={expr:n,type:"ASC"};return"DESC"==r&&(t.type="DESC"),t},Zr=function(n){return n},Qr=function(f,c){var n={type:"expr_list",value:void 0},r=function(n,r,t){for(var e,u=lu(f,c),o=[],i=0;i<u.length;i++)e=u[i],o.push(e);return o}();return n.value=r,n},$r=function(n,r){return vu(n,r)},Jr=function(n){return{type:"unary_expr",operator:"NOT",expr:n}},nt=function(n,r){return r?"arithmetic"==r.type?vu(n,r.tail):su(r.op,n,r.right):n},rt=function(n){return{type:"arithmetic",tail:n}},tt=function(n,r){return{op:n,right:r}},et=function(n,r,t){return{op:n,right:{type:"expr_list",value:[r,t]}}},ut=function(n){return n[0]+" "+n[2]},ot=function(n,r){return{op:n,right:r}},it=function(n,r){return vu(n,r)},ft=function(n){return n.paren=!0,n},ct=function(n,r){return{type:"column_ref",table:n,column:r}},at=function(n){return{type:"column_ref",table:"",column:n}},st=function(n){return!0===Eu[n.toUpperCase()]},lt=function(n){return n},vt=function(n){return n.join("")},pt=function(n){return n.join("")},ht=function(n,r){return{type:"aggr_func",name:n,field:r}},dt=function(n){return n},yt=function(){return{type:"null",value:null}},gt=function(){return{type:"bool",value:!0}},Et=function(){return{type:"bool",value:!1}},bt=function(n){return{type:"string",value:n[1].join("")}},mt=function(){return"'"},wt=function(){return'"'},Nt=function(){return"\\"},Ot=function(){return"/"},St=function(){return"\b"},Tt=function(){return"\f"},It=function(){return"\n"},At=function(){return"\r"},xt=function(){return"\t"},Rt=function(n,r,t,e){return String.fromCharCode(parseInt("0x"+n+r+t+e))},Ct=function(n){return{type:"number",value:n}},_t=function(n){return{type:"number",value:n}},jt=function(n,r,t){var e=parseFloat(n+r+t);return e%1!=0?e.toString():e.toString()+".0"},Lt=function(n,r){var t=parseFloat(n+r);return t%1!=0?t.toString():t.toString()+".0"},Ut=function(n,r){return parseFloat(n+r).toString()},Ft=function(n){return parseFloat(n).toString()},Mt=function(n,r){return n+r},Wt=function(n,r,t){return"-"+r+t},kt=function(n,r){return"-"+r},Dt=function(n){return"."+n},Ht=function(n,r){return n+r},Pt=function(n){return n.join("")},Bt=function(n,r){return n+r},Gt=function(){return"ASC"},qt=function(){return"DESC"},Yt=function(){return"ALL"},Xt=function(){return"DISTINCT"},Kt=function(){return"BETWEEN"},zt=function(){return"IN"},Vt=function(){return"IS"},Zt=function(){return"LIKE"},Qt=function(){return"CONTAINS"},$t=function(){return"NOT"},Jt=function(){return"AND"},ne=function(){return"OR"},re=function(){return"MAX"},te=function(){return"MIN"},ee=function(){return"SUM"},ue=function(){return"AVG"},oe=0,ie=[{line:1,column:1}],fe=[],ce=0;if("startRule"in o){if(!(o.startRule in r))throw new Error("Can't start parsing from rule \""+o.startRule+'".');t=r[o.startRule]}function ae(n,r){return{type:"literal",text:n,ignoreCase:r}}function se(n,r,t){return{type:"class",parts:n,inverted:r,ignoreCase:t}}function le(n){return{type:"other",description:n}}function ve(n){var r,t=ie[n];if(t)return t;for(r=n-1;!ie[r];)r--;for(t={line:(t=ie[r]).line,column:t.column};r<n;)10===on.charCodeAt(r)?(t.line++,t.column=1):t.column++,r++;return ie[n]=t}var pe="string"==typeof o.filename&&0<o.filename.length;function he(n,r){var t={};pe&&(t.filename=o.filename);var e=ve(n);t.start={offset:n,line:e.line,column:e.column};var u=ve(r);return t.end={offset:r,line:u.line,column:u.column},t}function de(){fe.push({pos:oe,variants:[]})}function ye(n){var r=fe[fe.length-1];oe<r.pos||(oe>r.pos&&(r.pos=oe,r.variants=[]),r.variants.push(n))}function ge(n){var r=fe.pop(),t=fe[fe.length-1],e=r.variants;t.pos===r.pos&&(n&&(e=e.map(function(n){return"not"===n.type?n.expected:{type:"not",expected:n}})),Array.prototype.push.apply(t.variants,e))}function Ee(){var n,r;return n=oe,cu(),(r=function(){var n,r,t,e,u,o,i,f;if(n=oe,(r=be())!==fn){for(t=[],e=oe,u=cu(),e=(o=Ze())!==fn?(i=cu(),(f=be())!==fn?u=[u,o,i,f]:(oe=e,fn)):(oe=e,fn);e!==fn;)t.push(e),e=oe,u=cu(),e=(o=Ze())!==fn?(i=cu(),(f=be())!==fn?u=[u,o,i,f]:(oe=e,fn)):(oe=e,fn);n=kr(r,t)}else oe=n,n=fn;return n}())!==fn?Wr(r):(oe=n,fn)}function be(){function n(n){0===ce&&ye(n)}var r,t,e,u,o,i,f,c,a,s,l,v,p,h,d,y,g,E,b,m,w,N,O,S,T,I,A,x,R,C,_,j,L,U,F,M,W,k,D,H,P,B,G,q,Y,X,K,z,V,Z,Q,$,J,nn,rn,tn,en;return nn=c=oe,0===ce&&ye(lr),on.substr(oe,6).toLowerCase()===vn?(rn=on.substr(oe,6),oe+=6):rn=fn,(r=(rn!==fn?(tn=oe,de(),en=Me(),ge(!0),(tn=en===fn?void 0:(oe=tn,fn))!==fn?rn=[rn,tn]:(oe=nn,fn)):(oe=nn,fn))!==fn?(cu(),Z=oe,0===ce&&ye(Nr),on.substr(oe,8).toLowerCase()===En?(Q=on.substr(oe,8),oe+=8):Q=fn,(a=Q!==fn?($=oe,de(),J=Me(),ge(!0),($=J===fn?void 0:(oe=$,fn))!==fn?Xt():(oe=Z,fn)):(oe=Z,fn))===fn&&(a=null),cu(),(s=function(){var n,r,t,e,u,o,i,f,c,a,s,l,v;if(0===ce&&ye(Sn),ce++,a=n=oe,on.substr(oe,3).toLowerCase()===gn?(s=on.substr(oe,3),oe+=3):s=fn,(r=s!==fn?(l=oe,de(),v=Me(),ge(!0),(l=v===fn?void 0:(oe=l,fn))!==fn?Yt():(oe=a,fn)):(oe=a,fn))===fn&&(r=oe,42===on.charCodeAt(oe)?(c=ln,oe++):c=fn,r=(t=c)!==fn?(e=oe,de(),u=Me(),ge(!0),(e=u===fn?void 0:(oe=e,fn))!==fn?t=[t,e]:(oe=r,fn)):(oe=r,fn)),r!==fn&&(r=Pr()),(n=r)===fn)if(n=oe,(r=me())!==fn){for(t=[],e=oe,u=cu(),e=(o=ou())!==fn?(i=cu(),(f=me())!==fn?u=[u,o,i,f]:(oe=e,fn)):(oe=e,fn);e!==fn;)t.push(e),e=oe,u=cu(),e=(o=ou())!==fn?(i=cu(),(f=me())!==fn?u=[u,o,i,f]:(oe=e,fn)):(oe=e,fn);n=Br(r,t)}else oe=n,n=fn;return ce--,n}())!==fn?(cu(),X=W=oe,0===ce&&ye(vr),on.substr(oe,4).toLowerCase()===pn?(K=on.substr(oe,4),oe+=4):K=fn,(l=(K!==fn?(z=oe,de(),V=Me(),ge(!0),(z=V===fn?void 0:(oe=z,fn))!==fn?K=[K,z]:(oe=X,fn)):(oe=X,fn))!==fn?(cu(),H=D=oe,(H=(P=Qe())!==fn?P=[P,B=cu()]:(oe=H,fn))===fn&&(H=null),(P=we())===fn&&(P=oe,un(Tn),96===on.charCodeAt(oe)?(B=sn,oe++):B=fn,P=B!==fn&&(G=we())!==fn?(un(Tn),96===on.charCodeAt(oe)?(q=sn,oe++):q=fn,q!==fn?B=[B,G,q]:(oe=P,fn)):(oe=P,fn)),(k=P!==fn?(B=cu(),(G=Ve())===fn&&(G=null),q=cu(),(Y=Le())===fn&&(Y=null),Xr(H,P,Y)):(oe=D,fn))!==fn?Yr(k):(oe=W,fn)):(oe=W,fn))===fn&&(l=null),cu(),L=_=oe,0===ce&&ye(dr),on.substr(oe,5).toLowerCase()===hn?(U=on.substr(oe,5),oe+=5):U=fn,(v=(U!==fn?(F=oe,de(),M=Me(),ge(!0),(F=M===fn?void 0:(oe=F,fn))!==fn?U=[U,F]:(oe=L,fn)):(oe=L,fn))!==fn?(cu(),(j=Oe())!==fn?zr(j):(oe=_,fn)):(oe=_,fn))===fn&&(v=null),cu(),R=oe,(p=Qe()!==fn?(cu(),$e()!==fn?(cu(),(C=function(){var n,r,t,e,u,o,i,f;if(n=oe,(r=je())!==fn){for(t=[],e=oe,u=cu(),e=(o=ou())!==fn?(i=cu(),(f=je())!==fn?u=[u,o,i,f]:(oe=e,fn)):(oe=e,fn);e!==fn;)t.push(e),e=oe,u=cu(),e=(o=ou())!==fn?(i=cu(),(f=je())!==fn?u=[u,o,i,f]:(oe=e,fn)):(oe=e,fn);n=Br(r,t)}else oe=n,n=fn;return n}())!==fn?Yr(C):(oe=R,fn)):(oe=R,fn)):(oe=R,fn))===fn&&(p=null),cu(),T=O=oe,0===ce&&ye(Er),on.substr(oe,5).toLowerCase()===dn?(I=on.substr(oe,5),oe+=5):I=fn,(h=(I!==fn?(A=oe,de(),x=Me(),ge(!0),(A=x===fn?void 0:(oe=A,fn))!==fn?I=[I,A]:(oe=T,fn)):(oe=T,fn))!==fn?(cu(),$e()!==fn?(cu(),(S=function(){var n,r,t,e,u,o,i,f;if(n=oe,(r=Ne())!==fn){for(t=[],e=oe,u=cu(),e=(o=ou())!==fn?(i=cu(),(f=Ne())!==fn?u=[u,o,i,f]:(oe=e,fn)):(oe=e,fn);e!==fn;)t.push(e),e=oe,u=cu(),e=(o=ou())!==fn?(i=cu(),(f=Ne())!==fn?u=[u,o,i,f]:(oe=e,fn)):(oe=e,fn);n=Br(r,t)}else oe=n,n=fn;return n}())!==fn?Yr(S):(oe=O,fn)):(oe=O,fn)):(oe=O,fn))===fn&&(h=null),cu(),b=y=oe,0===ce&&ye(br),on.substr(oe,5).toLowerCase()===yn?(m=on.substr(oe,5),oe+=5):m=fn,(d=(m!==fn?(w=oe,de(),N=Me(),ge(!0),(w=N===fn?void 0:(oe=w,fn))!==fn?m=[m,w]:(oe=b,fn)):(oe=b,fn))!==fn?(cu(),0===ce&&ye(tr),ce++,(E=Be())!==fn&&(E=_t(E)),ce--,(g=E)!==fn?Zr(g):(oe=y,fn)):(oe=y,fn))===fn&&(d=null),cu(),Hr(a,s,l,v,p,h,d)):(oe=c,fn)):(oe=c,fn))===fn&&(t=r=oe,n(Nn),40===on.charCodeAt(oe)?(e=cn,oe++):e=fn,(t=e!==fn?(u=cu(),(o=be())!==fn?(i=cu(),n(On),41===on.charCodeAt(oe)?(f=an,oe++):f=fn,f!==fn?e=[e,u,o,i,f]:(oe=t,fn)):(oe=t,fn)):(oe=t,fn))!==fn&&(t=Dr(t)),r=t),r;function un(n){0===ce&&ye(n)}}function me(){var n,r,t,e,u;return n=oe,(r=Ae())!==fn?(cu(),e=oe,Ve(),cu(),(t=(u=Le())!==fn?qr(u):(oe=e,fn))===fn&&(t=null),Gr(r,t)):(oe=n,fn)}function we(){function n(n){0===ce&&ye(n)}var r,t,e,u;if(r=[],t=oe,n(In),47===on.charCodeAt(oe)?(e=i,oe++):e=fn,e===fn&&(e=null),(t=(u=Fe())!==fn?e=[e,u]:(oe=t,fn))!==fn)for(;t!==fn;)r.push(t),t=oe,n(In),47===on.charCodeAt(oe)?(e=i,oe++):e=fn,e===fn&&(e=null),t=(u=Fe())!==fn?e=[e,u]:(oe=t,fn);else r=fn;return r!==fn&&(r=Kr(r)),r}function Ne(){var n,r,t,e,u,o,i,f,c,a,s;return n=oe,(r=Oe())!==fn?(cu(),f=oe,0===ce&&ye(wr),on.substr(oe,4).toLowerCase()===W?(c=on.substr(oe,4),oe+=4):c=fn,(t=c!==fn?(a=oe,de(),s=Me(),ge(!0),(a=s===fn?void 0:(oe=a,fn))!==fn?qt():(oe=f,fn)):(oe=f,fn))===fn&&(e=oe,0===ce&&ye(mr),on.substr(oe,3).toLowerCase()===M?(u=on.substr(oe,3),oe+=3):u=fn,t=u!==fn?(o=oe,de(),i=Me(),ge(!0),(o=i===fn?void 0:(oe=o,fn))!==fn?Gt():(oe=e,fn)):(oe=e,fn)),t===fn&&(t=null),Vr(r,t)):(oe=n,fn)}function Oe(){var n,r,t,e,u,o,i,f;if(n=oe,(r=Se())!==fn){for(t=[],e=oe,u=cu(),e=(o=uu())!==fn?(i=cu(),(f=Se())!==fn?u=[u,o,i,f]:(oe=e,fn)):(oe=e,fn);e!==fn;)t.push(e),e=oe,u=cu(),e=(o=uu())!==fn?(i=cu(),(f=Se())!==fn?u=[u,o,i,f]:(oe=e,fn)):(oe=e,fn);n=$r(r,t)}else oe=n,n=fn;return n}function Se(){var n,r,t,e,u,o,i,f;if(n=oe,(r=Te())!==fn){for(t=[],e=oe,u=cu(),e=(o=eu())!==fn?(i=cu(),(f=Te())!==fn?u=[u,o,i,f]:(oe=e,fn)):(oe=e,fn);e!==fn;)t.push(e),e=oe,u=cu(),e=(o=eu())!==fn?(i=cu(),(f=Te())!==fn?u=[u,o,i,f]:(oe=e,fn)):(oe=e,fn);n=$r(r,t)}else oe=n,n=fn;return n}function Te(){function n(n){0===ce&&ye(n)}var r,t,e,u,o;return r=oe,(t=tu())===fn&&(t=oe,n(An),33===on.charCodeAt(oe)?(e=f,oe++):e=fn,t=e!==fn?(u=oe,de(),n(xn),61===on.charCodeAt(oe)?(o=c,oe++):o=fn,ge(!0),(u=o===fn?void 0:(oe=u,fn))!==fn?e=[e,u]:(oe=t,fn)):(oe=t,fn)),(r=t!==fn?(e=cu(),(u=Te())!==fn?Jr(u):(oe=r,fn)):(oe=r,fn))===fn&&(r=function n(){var r,t,e,u,o,i,f,c,a,s,l,v,p,h,d,y,g,E,b,m,w,N,O,S,T,I,A,x,R,C,_,j,L,U,F,M,W,k,D,H,P,B,G;return r=oe,(t=Ae())!==fn?(cu(),(u=function(){var n,r,t,e,u,o;if(n=[],r=oe,t=cu(),(r=(e=Ie())!==fn?(u=cu(),(o=Ae())!==fn?t=[t,e,u,o]:(oe=r,fn)):(oe=r,fn))!==fn)for(;r!==fn;)n.push(r),r=oe,t=cu(),r=(e=Ie())!==fn?(u=cu(),(o=Ae())!==fn?t=[t,e,u,o]:(oe=r,fn)):(oe=r,fn);else n=fn;return n!==fn&&(n=rt(n)),n}())===fn&&(H=D=M=oe,(H=(P=tu())!==fn?(B=cu(),(G=Je())!==fn?P=[P,B,G]:(oe=H,fn)):(oe=H,fn))!==fn&&(H=ut(H)),(D=H)===fn&&(D=Je()),(u=(W=D)!==fn?(cu(),iu()!==fn?(cu(),(k=function(){var n,r,t,e,u,o,i,f;if(n=oe,(r=Oe())!==fn){for(t=[],e=oe,u=cu(),e=(o=ou())!==fn?(i=cu(),(f=Oe())!==fn?u=[u,o,i,f]:(oe=e,fn)):(oe=e,fn);e!==fn;)t.push(e),e=oe,u=cu(),e=(o=ou())!==fn?(i=cu(),(f=Oe())!==fn?u=[u,o,i,f]:(oe=e,fn)):(oe=e,fn);n=Qr(r,t)}else oe=n,n=fn;return n}())!==fn?(cu(),fu()!==fn?ot(W,k):(oe=M,fn)):(oe=M,fn)):(oe=M,fn)):(oe=M,fn))===fn)&&(j=x=oe,0===ce&&ye(Or),on.substr(oe,7).toLowerCase()===q?(L=on.substr(oe,7),oe+=7):L=fn,(u=(R=L!==fn?(U=oe,de(),F=Me(),ge(!0),(U=F===fn?void 0:(oe=U,fn))!==fn?Kt():(oe=j,fn)):(oe=j,fn))!==fn?(cu(),(C=Ae())!==fn?(cu(),eu()!==fn?(cu(),(_=Ae())!==fn?et(R,C,_):(oe=x,fn)):(oe=x,fn)):(oe=x,fn)):(oe=x,fn))===fn)&&(S=w=oe,0===ce&&ye(Tr),on.substr(oe,2).toLowerCase()===Y?(T=on.substr(oe,2),oe+=2):T=fn,(u=(N=T!==fn?(I=oe,de(),A=Me(),ge(!0),(I=A===fn?void 0:(oe=I,fn))!==fn?Vt():(oe=S,fn)):(oe=S,fn))!==fn?(cu(),(O=Ae())!==fn?tt(N,O):(oe=w,fn)):(oe=w,fn))===fn)&&(g=y=p=oe,(g=(E=tu())!==fn?(b=cu(),(m=nu())!==fn?E=[E,b,m]:(oe=g,fn)):(oe=g,fn))!==fn&&(g=ut(g)),(y=g)===fn&&(y=nu()),(u=(h=y)!==fn?(cu(),(d=n())!==fn?tt(h,d):(oe=p,fn)):(oe=p,fn))===fn)&&(a=c=o=oe,(a=(s=tu())!==fn?(l=cu(),(v=ru())!==fn?s=[s,l,v]:(oe=a,fn)):(oe=a,fn))!==fn&&(a=ut(a)),(c=a)===fn&&(c=ru()),u=(i=c)!==fn?(cu(),(f=ke())!==fn?ot(i,f):(oe=o,fn)):(oe=o,fn)),(e=u)===fn&&(e=null),nt(t,e)):(oe=r,fn)}()),r}function Ie(){function n(n){0===ce&&ye(n)}var r;return n(Rn),on.substr(oe,2)===e?(r=e,oe+=2):r=fn,r===fn&&(n(Cn),62===on.charCodeAt(oe)?(r=u,oe++):r=fn,r===fn&&(n(_n),on.substr(oe,2)===a?(r=a,oe+=2):r=fn,r===fn&&(n(jn),on.substr(oe,2)===s?(r=s,oe+=2):r=fn,r===fn&&(n(Ln),60===on.charCodeAt(oe)?(r=l,oe++):r=fn,r===fn&&(n(xn),61===on.charCodeAt(oe)?(r=c,oe++):r=fn,r===fn&&(n(Un),on.substr(oe,2)===v?(r=v,oe+=2):r=fn)))))),r}function Ae(){var n,r,t,e,u,o,i,f;if(n=oe,(r=Re())!==fn){for(t=[],e=oe,u=cu(),e=(o=xe())!==fn?(i=cu(),(f=Re())!==fn?u=[u,o,i,f]:(oe=e,fn)):(oe=e,fn);e!==fn;)t.push(e),e=oe,u=cu(),e=(o=xe())!==fn?(i=cu(),(f=Re())!==fn?u=[u,o,i,f]:(oe=e,fn)):(oe=e,fn);n=$r(r,t)}else oe=n,n=fn;return n}function xe(){function n(n){0===ce&&ye(n)}var r;return n(Fn),43===on.charCodeAt(oe)?(r=p,oe++):r=fn,r===fn&&(n(Mn),45===on.charCodeAt(oe)?(r=h,oe++):r=fn),r}function Re(){var n,r,t,e,u,o,i,f;if(n=oe,(r=_e())!==fn){for(t=[],e=oe,u=cu(),e=(o=Ce())!==fn?(i=cu(),(f=_e())!==fn?u=[u,o,i,f]:(oe=e,fn)):(oe=e,fn);e!==fn;)t.push(e),e=oe,u=cu(),e=(o=Ce())!==fn?(i=cu(),(f=_e())!==fn?u=[u,o,i,f]:(oe=e,fn)):(oe=e,fn);n=it(r,t)}else oe=n,n=fn;return n}function Ce(){function n(n){0===ce&&ye(n)}var r;return n(Wn),42===on.charCodeAt(oe)?(r=ln,oe++):r=fn,r===fn&&(n(In),47===on.charCodeAt(oe)?(r=i,oe++):r=fn,r===fn&&(n(kn),37===on.charCodeAt(oe)?(r=d,oe++):r=fn)),r}function _e(){var n,r,t,e,u,o,i,f,c,a,s,l,v,p,h,d,y,g,E,b,m,w;return(n=ke())===fn&&(E=t=oe,0===ce&&ye(Lr),on.substr(oe,3).toLowerCase()===z?(b=on.substr(oe,3),oe+=3):b=fn,(o=b!==fn?(m=oe,de(),w=Me(),ge(!0),(m=w===fn?void 0:(oe=m,fn))!==fn?ee():(oe=E,fn)):(oe=E,fn))!==fn||(h=oe,0===ce&&ye(_r),on.substr(oe,3).toLowerCase()===X?(d=on.substr(oe,3),oe+=3):d=fn,(o=d!==fn?(y=oe,de(),g=Me(),ge(!0),(y=g===fn?void 0:(oe=y,fn))!==fn?re():(oe=h,fn)):(oe=h,fn))===fn&&(s=oe,0===ce&&ye(jr),on.substr(oe,3).toLowerCase()===K?(l=on.substr(oe,3),oe+=3):l=fn,(o=l!==fn?(v=oe,de(),p=Me(),ge(!0),(v=p===fn?void 0:(oe=v,fn))!==fn?te():(oe=s,fn)):(oe=s,fn))===fn)&&(i=oe,0===ce&&ye(Ur),on.substr(oe,3).toLowerCase()===V?(f=on.substr(oe,3),oe+=3):f=fn,o=f!==fn?(c=oe,de(),a=Me(),ge(!0),(c=a===fn?void 0:(oe=c,fn))!==fn?ue():(oe=i,fn)):(oe=i,fn))),o!==fn&&(o=dt(o)),(n=(e=o)!==fn?(cu(),iu()!==fn?(cu(),(u=Fe())!==fn?(cu(),fu()!==fn?ht(e,u):(oe=t,fn)):(oe=t,fn)):(oe=t,fn)):(oe=t,fn))===fn)&&(n=je())===fn&&(n=oe,n=iu()!==fn?(cu(),(r=Oe())!==fn?(cu(),fu()!==fn?ft(r):(oe=n,fn)):(oe=n,fn)):(oe=n,fn)),n}function je(){var n,r,t,e;return n=oe,(n=(r=Le())!==fn?(cu(),0===ce&&ye(er),46===on.charCodeAt(oe)?(e=x,oe++):e=fn,e!==fn?(cu(),(t=Ue())!==fn?ct(r,t):(oe=n,fn)):(oe=n,fn)):(oe=n,fn))===fn&&(n=oe,(r=Ue())!==fn&&(r=at(r)),n=r),n}function Le(){var n,r;return n=oe,(r=Fe())!==fn&&(st(r)?fn:void 0)!==fn?lt(r):(oe=n,fn)}function Ue(){function n(n){0===ce&&ye(n)}var r,t,e,u;if(r=oe,(r=(t=Fe())!==fn&&(e=(e=st(t))?fn:void 0)!==fn?lt(t):(oe=r,fn))===fn)if(r=oe,n(Tn),96===on.charCodeAt(oe)?(t=sn,oe++):t=fn,t!==fn){if(e=[],n(Dn),Q.test(on.charAt(oe))?(u=on.charAt(oe),oe++):u=fn,u!==fn)for(;u!==fn;)e.push(u),n(Dn),Q.test(on.charAt(oe))?(u=on.charAt(oe),oe++):u=fn;else e=fn;r=e!==fn?(n(Tn),96===on.charCodeAt(oe)?(u=sn,oe++):u=fn,u!==fn?vt(e):(oe=r,fn)):(oe=r,fn)}else oe=r,r=fn;return r}function Fe(){var n,r;if(n=[],(r=We())!==fn)for(;r!==fn;)n.push(r),r=We();else n=fn;return n!==fn&&(n=pt(n)),n}function Me(){var n;return 0===ce&&ye(Hn),$.test(on.charAt(oe))?(n=on.charAt(oe),oe++):n=fn,n}function We(){var n;return 0===ce&&ye(Pn),J.test(on.charAt(oe))?(n=on.charAt(oe),oe++):n=fn,n}function ke(){var n,r,t,e,u,o,i,f,c,a,s,l,v,p,h,d,y,g,E,b,m;return(n=function(){function n(n){0===ce&&ye(n)}var r,t,e,u;if(r=oe,n(Bn),34===on.charCodeAt(oe)?(t=w,oe++):t=fn,t!==fn){for(e=[],u=He();u!==fn;)e.push(u),u=He();n(Bn),34===on.charCodeAt(oe)?(u=w,oe++):u=fn,r=u!==fn?t=[t,e,u]:(oe=r,fn)}else oe=r,r=fn;if(r===fn)if(r=oe,n(Gn),39===on.charCodeAt(oe)?(t=N,oe++):t=fn,t!==fn){for(e=[],u=De();u!==fn;)e.push(u),u=De();n(Gn),39===on.charCodeAt(oe)?(u=N,oe++):u=fn,r=u!==fn?t=[t,e,u]:(oe=r,fn)}else oe=r,r=fn;return r!==fn&&(r=bt(r)),r}())===fn&&(g=oe,(g=(E=Be())!==fn&&(b=Ge())!==fn&&(m=qe())!==fn?(cu(),jt(E,b,m)):(oe=g,fn))===fn&&(g=oe,(g=(E=Be())!==fn&&(b=Ge())!==fn?(m=cu(),Lt(E,b)):(oe=g,fn))===fn&&(g=oe,(g=(E=Be())!==fn&&(b=qe())!==fn?(m=cu(),Ut(E,b)):(oe=g,fn))===fn&&(g=oe,g=(E=Be())!==fn?(b=cu(),Ft(E)):(oe=g,fn)))),(y=g)!==fn&&(y=Ct(y)),(n=y)===fn)&&(v=i=oe,0===ce&&ye(ar),on.substr(oe,4).toLowerCase()===C?(p=on.substr(oe,4),oe+=4):p=fn,(f=p!==fn?(h=oe,de(),d=Me(),ge(!0),(h=d===fn?void 0:(oe=h,fn))!==fn?p=[p,h]:(oe=v,fn)):(oe=v,fn))!==fn&&(f=gt()),(i=f)===fn&&(c=i=oe,0===ce&&ye(sr),on.substr(oe,5).toLowerCase()===_?(a=on.substr(oe,5),oe+=5):a=fn,(f=a!==fn?(s=oe,de(),l=Me(),ge(!0),(s=l===fn?void 0:(oe=s,fn))!==fn?a=[a,s]:(oe=c,fn)):(oe=c,fn))!==fn&&(f=Et()),i=f),(n=i)===fn)&&(t=oe,0===ce&&ye(cr),on.substr(oe,4).toLowerCase()===R?(e=on.substr(oe,4),oe+=4):e=fn,(r=e!==fn?(u=oe,de(),o=Me(),ge(!0),(u=o===fn?void 0:(oe=u,fn))!==fn?e=[e,u]:(oe=t,fn)):(oe=t,fn))!==fn&&(r=yt()),n=r),n}function De(){var n;return 0===ce&&ye(qn),nn.test(on.charAt(oe))?(n=on.charAt(oe),oe++):n=fn,n===fn&&(n=Pe()),n}function He(){var n;return 0===ce&&ye(Yn),rn.test(on.charAt(oe))?(n=on.charAt(oe),oe++):n=fn,n===fn&&(n=Pe()),n}function Pe(){function n(n){0===ce&&ye(n)}var r,t,e,u,o,i;return r=oe,n(Xn),on.substr(oe,2)===y?(t=y,oe+=2):t=fn,t!==fn&&(t=mt()),(r=t)===fn&&(r=oe,n(Kn),on.substr(oe,2)===g?(t=g,oe+=2):t=fn,t!==fn&&(t=wt()),(r=t)===fn&&(r=oe,n(zn),on.substr(oe,2)===E?(t=E,oe+=2):t=fn,t!==fn&&(t=Nt()),(r=t)===fn&&(r=oe,n(Vn),on.substr(oe,2)===b?(t=b,oe+=2):t=fn,t!==fn&&(t=Ot()),(r=t)===fn&&(r=oe,n(Zn),on.substr(oe,2)===m?(t=m,oe+=2):t=fn,t!==fn&&(t=St()),(r=t)===fn&&(r=oe,n(Qn),on.substr(oe,2)===O?(t=O,oe+=2):t=fn,t!==fn&&(t=Tt()),(r=t)===fn&&(r=oe,n($n),on.substr(oe,2)===S?(t=S,oe+=2):t=fn,t!==fn&&(t=It()),(r=t)===fn&&(r=oe,n(Jn),on.substr(oe,2)===T?(t=T,oe+=2):t=fn,t!==fn&&(t=At()),(r=t)===fn&&(r=oe,n(nr),on.substr(oe,2)===I?(t=I,oe+=2):t=fn,t!==fn&&(t=xt()),(r=t)===fn&&(r=oe,n(rr),on.substr(oe,2)===A?(t=A,oe+=2):t=fn,r=t!==fn&&(e=ze())!==fn&&(u=ze())!==fn&&(o=ze())!==fn&&(i=ze())!==fn?Rt(e,u,o,i):(oe=r,fn)))))))))),r}function Be(){function n(n){0===ce&&ye(n)}var r,t,e,u;return r=oe,(r=(t=Ke())!==fn&&(e=Ye())!==fn?Mt(t,e):(oe=r,fn))===fn&&(r=Xe())===fn&&(r=oe,n(Mn),45===on.charCodeAt(oe)?(t=h,oe++):t=fn,t===fn&&(n(Fn),43===on.charCodeAt(oe)?(t=p,oe++):t=fn),(r=t!==fn&&(e=Ke())!==fn&&(u=Ye())!==fn?Wt(t,e,u):(oe=r,fn))===fn&&(r=oe,n(Mn),45===on.charCodeAt(oe)?(t=h,oe++):t=fn,t===fn&&(n(Fn),43===on.charCodeAt(oe)?(t=p,oe++):t=fn),r=t!==fn&&(e=Xe())!==fn?kt(t,e):(oe=r,fn))),r}function Ge(){var n,r,t;return n=oe,0===ce&&ye(er),46===on.charCodeAt(oe)?(r=x,oe++):r=fn,r!==fn&&(t=Ye())!==fn?Dt(t):(oe=n,fn)}function qe(){var n,r,t,e,u,o;return e=n=oe,i(ir),bn.test(on.charAt(oe))?(u=on.charAt(oe),oe++):u=fn,(r=u!==fn?(i(fr),mn.test(on.charAt(oe))?(o=on.charAt(oe),oe++):o=fn,o===fn&&(o=null),Bt(u,o)):(oe=e,fn))!==fn&&(t=Ye())!==fn?Ht(r,t):(oe=n,fn);function i(n){0===ce&&ye(n)}}function Ye(){var n,r;if(n=[],(r=Xe())!==fn)for(;r!==fn;)n.push(r),r=Xe();else n=fn;return n!==fn&&(n=Pt(n)),n}function Xe(){var n;return 0===ce&&ye(ur),ce++,tn.test(on.charAt(oe))?(n=on.charAt(oe),oe++):n=fn,ce--,n}function Ke(){var n;return 0===ce&&ye(ur),ce++,en.test(on.charAt(oe))?(n=on.charAt(oe),oe++):n=fn,ce--,n}function ze(){var n;return 0===ce&&ye(or),ce++,un.test(on.charAt(oe))?(n=on.charAt(oe),oe++):n=fn,ce--,n}function Ve(){var n,r,t,e;return n=oe,0===ce&&ye(pr),on.substr(oe,2).toLowerCase()===j?(r=on.substr(oe,2),oe+=2):r=fn,r!==fn?(t=oe,de(),e=Me(),ge(!0),(t=e===fn?void 0:(oe=t,fn))!==fn?r=[r,t]:(oe=n,fn)):(oe=n,fn)}function Ze(){var n,r,t,e;return n=oe,0===ce&&ye(hr),on.substr(oe,5).toLowerCase()===L?(r=on.substr(oe,5),oe+=5):r=fn,r!==fn?(t=oe,de(),e=Me(),ge(!0),(t=e===fn?void 0:(oe=t,fn))!==fn?r=[r,t]:(oe=n,fn)):(oe=n,fn)}function Qe(){var n,r,t,e;return n=oe,0===ce&&ye(yr),on.substr(oe,5).toLowerCase()===U?(r=on.substr(oe,5),oe+=5):r=fn,r!==fn?(t=oe,de(),e=Me(),ge(!0),(t=e===fn?void 0:(oe=t,fn))!==fn?r=[r,t]:(oe=n,fn)):(oe=n,fn)}function $e(){var n,r,t,e;return n=oe,0===ce&&ye(gr),on.substr(oe,2).toLowerCase()===F?(r=on.substr(oe,2),oe+=2):r=fn,r!==fn?(t=oe,de(),e=Me(),ge(!0),(t=e===fn?void 0:(oe=t,fn))!==fn?r=[r,t]:(oe=n,fn)):(oe=n,fn)}function Je(){var n,r,t,e;return n=oe,0===ce&&ye(Sr),on.substr(oe,2).toLowerCase()===k?(r=on.substr(oe,2),oe+=2):r=fn,r!==fn?(t=oe,de(),e=Me(),ge(!0),(t=e===fn?void 0:(oe=t,fn))!==fn?zt():(oe=n,fn)):(oe=n,fn)}function nu(){var n,r,t,e;return n=oe,0===ce&&ye(Ir),on.substr(oe,4).toLowerCase()===D?(r=on.substr(oe,4),oe+=4):r=fn,r!==fn?(t=oe,de(),e=Me(),ge(!0),(t=e===fn?void 0:(oe=t,fn))!==fn?Zt():(oe=n,fn)):(oe=n,fn)}function ru(){var n,r,t,e;return n=oe,0===ce&&ye(Ar),on.substr(oe,8).toLowerCase()===H?(r=on.substr(oe,8),oe+=8):r=fn,r!==fn?(t=oe,de(),e=Me(),ge(!0),(t=e===fn?void 0:(oe=t,fn))!==fn?Qt():(oe=n,fn)):(oe=n,fn)}function tu(){var n,r,t,e;return n=oe,0===ce&&ye(xr),on.substr(oe,3).toLowerCase()===P?(r=on.substr(oe,3),oe+=3):r=fn,r!==fn?(t=oe,de(),e=Me(),ge(!0),(t=e===fn?void 0:(oe=t,fn))!==fn?$t():(oe=n,fn)):(oe=n,fn)}function eu(){var n,r,t,e;return n=oe,0===ce&&ye(Rr),on.substr(oe,3).toLowerCase()===B?(r=on.substr(oe,3),oe+=3):r=fn,r!==fn?(t=oe,de(),e=Me(),ge(!0),(t=e===fn?void 0:(oe=t,fn))!==fn?Jt():(oe=n,fn)):(oe=n,fn)}function uu(){var n,r,t,e;return n=oe,0===ce&&ye(Cr),on.substr(oe,2).toLowerCase()===G?(r=on.substr(oe,2),oe+=2):r=fn,r!==fn?(t=oe,de(),e=Me(),ge(!0),(t=e===fn?void 0:(oe=t,fn))!==fn?ne():(oe=n,fn)):(oe=n,fn)}function ou(){var n;return 0===ce&&ye(Fr),44===on.charCodeAt(oe)?(n=Z,oe++):n=fn,n}function iu(){var n;return 0===ce&&ye(Nn),40===on.charCodeAt(oe)?(n=cn,oe++):n=fn,n}function fu(){var n;return 0===ce&&ye(On),41===on.charCodeAt(oe)?(n=an,oe++):n=fn,n}function cu(){var n,r;for(n=[],r=au();r!==fn;)n.push(r),r=au();return n}function au(){var n;return 0===ce&&ye(Mr),ce++,wn.test(on.charAt(oe))?(n=on.charAt(oe),oe++):n=fn,ce--,n}function su(n,r,t){return{type:"binary_expr",operator:n,left:r,right:t}}function lu(n,r){for(var t=[n],e=0;e<r.length;e++)t.push(r[e][3]);return t}function vu(n,r){for(var t=n,e=0;e<r.length;e++)t=su(r[e][1],t,r[e][3]);return t}var pu,hu,du,yu,gu,Eu={SHOW:!0,DROP:!0,SELECT:!0,UPDATE:!0,CREATE:!0,DELETE:!0,INSERT:!0,REPLACE:!0,EXPLAIN:!0,ALL:!0,DISTINCT:!0,AS:!0,TABLE:!0,INTO:!0,FROM:!0,SET:!0,LEFT:!0,ON:!0,INNER:!0,JOIN:!0,UNION:!0,VALUES:!0,EXISTS:!0,WHERE:!0,GROUP:!0,BY:!0,HAVING:!0,ORDER:!0,ASC:!0,DESC:!0,LIMIT:!0,BETWEEN:!0,IN:!0,IS:!0,LIKE:!0,CONTAINS:!0,NOT:!0,AND:!0,OR:!0,TRUE:!0,FALSE:!0,NULL:!0};if(de(),(n=t())!==fn&&oe===on.length)return n;throw n!==fn&&oe<on.length&&ye({type:"end"}),gu=(yu=fe[0]).pos,pu=yu.variants,hu=gu<on.length?on.charAt(gu):null,du=gu<on.length?he(gu,gu+1):he(gu,gu),new bu(bu.buildMessage(pu,hu),pu,hu,du)}t=bu,e=Error,u.prototype=e.prototype,t.prototype=new u,bu.buildMessage=function(u,n){var r,t={literal:function(n){return'"'+o(n.text)+'"'},class:function(n){var r=n.parts.map(function(n){return Array.isArray(n)?i(n[0])+"-"+i(n[1]):i(n)});return"["+(n.inverted?"^":"")+r+"]"},any:function(){return"any character"},end:function(){return"end of input"},other:function(n){return n.description},not:function(n){return"not "+f(n.expected)}};function e(n){return n.charCodeAt(0).toString(16).toUpperCase()}function o(n){return n.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(n){return"\\x0"+e(n)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(n){return"\\x"+e(n)})}function i(n){return n.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(n){return"\\x0"+e(n)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(n){return"\\x"+e(n)})}function f(n){return t[n.type](n)}return"Expected "+function(n){var r,t,e=u.map(f);if(e.sort(),0<e.length){for(t=r=1;r<e.length;r++)e[r-1]!==e[r]&&(e[t]=e[r],t++);e.length=t}switch(e.length){case 1:return e[0];case 2:return e[0]+" or "+e[1];default:return e.slice(0,-1).join(", ")+", or "+e[e.length-1]}}()+" but "+((r=n)?'"'+o(r)+'"':"end of input")+" found."};var g="__name__";function E(n,r){if(!n)throw new Error(r)}function b(n,r){return Object.prototype.hasOwnProperty.call(n,r)}function c(n,r){if(b(n,r))return n[r]}function a(n){var r;switch(n.type){case"bool":case"null":case"string":r=n.value;break;case"number":r=Number(n.value);break;default:throw new Error("Unsupported value type in WHERE clause.")}return r}function m(n,r,t){return null!==r&&0<r.length?r:t?t.name+"("+n+")":n}function w(n){this.key=n,this.documents=[],this.aggr={sum:{},avg:{},min:{},max:{},total:{}}}function N(n,r,t,e){if("!="===t||"<>"===t){if("bool"!==e.type)return N(n,r,"<",e).concat(N(n,r,">",e));var u={type:"bool",value:!e.value};return N(n,r,"=",u)}var o=a(e),i=function(n){var r;switch(n){case"=":case"IS":r="==";break;case"<":case"<=":case">":case">=":r=n;break;case"CONTAINS":r="array-contains";break;case"NOT":case"NOT CONTAINS":throw new Error('"NOT" WHERE operator unsupported');default:throw new Error("Unknown WHERE operator")}return r}(t);return n.map(function(n){return n.where(r,i,o)})}function O(n){return{type:"string",value:n}}var o=["MIN","MAX","SUM","AVG"],S=(i.prototype.r=function(n){E((n=n||this.t).from.parts.length%2==1,'"FROM" needs a path to a collection (odd number of parts).');var t,r=n.from.parts.join("/"),e=[];if(n.from.group){E(""===this.e.path,"Collection group queries are only allowed from the root of the database.");var u=b(this.e,"firestore")?this.e.firestore:this.e;E("function"==typeof u.collectionGroup,"Your version of the Firebase SDK doesn't support collection group queries."),e.push(u.collectionGroup(r))}else e.push(this.e.collection(r));return n.where&&(e=function n(r,t){if("binary_expr"===t.type)if("AND"===t.operator)r=n(r=n(r,t.left),t.right);else if("OR"===t.operator)r=n(r,t.left).concat(n(r,t.right));else if("IN"===t.operator){E("column_ref"===t.left.type,"Unsupported WHERE type on left side."),E("expr_list"===t.right.type,"Unsupported WHERE type on right side.");var e=[];t.right.value.forEach(function(n){e.push.apply(e,N(r,t.left.column,"=",n))}),r=e}else if("LIKE"===t.operator){E("column_ref"===t.left.type,"Unsupported WHERE type on left side."),E("string"===t.right.type,"Only strings are supported with LIKE in WHERE clause.");var u=(f={},c=(i=t.right.value).length,"%"===i[0]?"%"===i[c-1]?f.contains=O(i.substr(1,c-2)):f.endsWith=O(i.substring(1)):"%"===i[c-1]?f.beginsWith=O(i.substr(0,c-1)):f.equals=O(i),f);if(void 0!==u.equals)r=N(r,t.left.column,"=",u.equals);else{if(void 0===u.beginsWith)throw new Error('Only terms in the form of "value%" (string begins with value) and "value" (string equals value) are supported with LIKE in WHERE clause.');var o=function(n){for(var r=u.beginsWith.value;0<r.length;){var t=r.length-1;if("ÿ"!==r[t]){r=r.substr(0,t)+String.fromCharCode(r.charCodeAt(t)+1);break}r=r.slice(0,-1)}return r}();r=N(r=N(r,t.left.column,">=",u.beginsWith),t.left.column,"<",O(o))}}else r="BETWEEN"===t.operator?(E("column_ref"===t.left.type,"Unsupported WHERE type on left side."),E("expr_list"===t.right.type&&2===t.right.value.length,"BETWEEN needs 2 values in WHERE clause."),N(r=N(r,t.left.column,">=",t.right.value[0]),t.left.column,"<=",t.right.value[1])):("CONTAINS"===t.operator?(E("column_ref"===t.left.type,"Unsupported WHERE type on left side."),E(["string","number","bool","null"].includes(t.right.type),"Only strings, numbers, booleans, and null are supported with CONTAINS in WHERE clause.")):E("column_ref"===t.left.type,"Unsupported WHERE type on left side."),N(r,t.left.column,t.operator,t.right));else{if("column_ref"!==t.type)throw new Error("Unsupported WHERE clause");r=r.map(function(n){return n.where(t.column,"==",!0)})}var i,f,c;return r}(e,n.where)),n.orderby&&(t=e,n.orderby.forEach(function(r){E("column_ref"===r.expr.type,"ORDER BY only supports ordering by field names."),t=t.map(function(n){return n.orderBy(r.expr.column,r.type.toLowerCase())})}),e=t),n.limit&&(e=function(n,r){E("number"===r.type,"LIMIT has to be a number.");var t=a(r);return n.map(function(n){return n.limit(t)})}(e,n.limit)),n.n&&(E("select"===n.n.type," UNION statements are only supported between SELECTs."),e=e.concat(this.r(n.n))),e},i.prototype.u=function(t){return h(this,void 0,void 0,function(){var c,a,r=this;return d(this,function(n){switch(n.label){case 0:c=[],a={},n.label=1;case 1:return n.trys.push([1,3,,4]),[4,Promise.all(t.map(function(f){return h(r,void 0,void 0,function(){var r,t,e,u,o,i;return d(this,function(n){switch(n.label){case 0:return[4,f.get()];case 1:for(r=n.sent(),t=r.docs.length,e=0;e<t;e++)u=r.docs[e],o=u.ref.path,b(a,o)||(i=u.data(),this.o&&(i["string"==typeof this.o?this.o:g]=u.id),c.push(i),a[o]=!0);return[2]}})})}))];case 2:return n.sent(),[3,4];case 3:throw n.sent();case 4:return[2,c]}})})},i.prototype.i=function(n,r){if(0===r.length)return[];if(this.t.groupby){var t=function(n,r){E(0<r.length,"GROUP BY needs at least 1 group.");var t=new w;return t.documents=n,r.forEach(function(n){E("column_ref"===n.type,"GROUP BY only supports grouping by field names."),t=function r(t,e){var u={};if(t instanceof w){for(var n=t.documents.length,o=0;o<n;o++){var i=t.documents[o],f=String(c(i,e.column));b(u,f)||(u[f]=new w),u[f].documents.push(i)}return u}return Object.keys(t).forEach(function(n){u[n]=r(t[n],e)}),u}(t,n)}),t}(r,this.t.groupby);return this.c(n,t)}return this.s(n,r)},i.prototype.s=function(n,r){var t,e,u,o,i=this;if(this.t.orderby&&1<n.length&&(u=r,o=this.t.orderby,r=u.sort(function(e,u){return o.reduce(function(n,r){if(0!==n)return n;var t=r.expr.column;return n=e[t]<u[t]?-1:e[t]>u[t]?1:0,"DESC"===r.type&&0!==n&&(n=-n),n},0)})),this.t.limit&&1<n.length&&(t=r,e=a(this.t.limit),t.splice(e),r=t),"string"==typeof this.t.columns&&"*"===this.t.columns);else{if(!Array.isArray(this.t.columns))throw new Error("Internal error (ast.columns).");var f=I(this.t.columns);if(0<f.length){var c=new w;c.documents=r,T(c,f),r=[this.l(c.documents[0],c.aggr)]}else r=r.map(function(n){return i.l(n)})}return r},i.prototype.c=function(n,r){var e=this;E("*"!==this.t.columns,'Cannot "SELECT *" when using GROUP BY.');var u=I(this.t.columns),o=function n(r){var t={};for(var e in r)if(b(r,e))if(r[e]instanceof w)t[e]=r[e];else{var u=n(r[e]);for(var o in u)b(u,o)&&(t[e+"$$"+o]=u[o])}return t}(r);if(0===u.length){var t=Object.keys(o)[0],i=o[t].documents[0];return[this.l(i)]}var f=[];return E(!this.t.orderby,"ORDER BY is not yet supported when using GROUP BY."),E(!this.t.limit,"LIMIT is not yet supported when using GROUP BY."),Object.keys(o).forEach(function(n){var r=o[n];T(r,u);var t=e.l(r.documents[0],r.aggr);f.push(t)}),f},i.prototype.l=function(o,i,n){void 0===n&&(n=!1);var f=!1,r=this.t.columns.reduce(function(n,r){var t,e,u;switch(r.expr.type){case"column_ref":e=m(t=r.expr.column,r.as),n.push(new x(t,e,(u=o,t.split(".").some(function(n){return u=c(u,n),!1}),u))),t===g&&(f=!0);break;case"aggr_func":A(r.expr),e=m(t=r.expr.field,r.as,r.expr),n.push(new x(t,e,i[r.expr.name.toLowerCase()][t]));break;default:throw new Error("Unsupported type in SELECT.")}return n},[]);return this.o&&!f&&r.push(new x(g,"string"==typeof this.o?this.o:g,c(o,g))),n?r:r.reduce(function(n,r){return n[r.alias]=r.value,n},{})},i);function i(n,r,t){if(this.e=n,this.t=r,this.o=t.includeId||!1,!this.o&&Array.isArray(r.columns))for(var e=0;e<r.columns.length;e++)if("column_ref"===r.columns[e].expr.type&&r.columns[e].expr.column===g){this.o=!0;break}void 0===this.o&&(this.o=!1)}function T(o,r){for(var n=o.documents.length,t=function(n){var e=o.documents[n],u={};r.forEach(function(n){var r=c(e,n.field),t=!Number.isNaN(r);switch(n.name){case"AVG":o.aggr.avg[n.field]=0;case"SUM":!0!==c(u,n.field)&&(u[n.field]=!0,b(o.aggr.total,n.field)||(o.aggr.total[n.field]=0,o.aggr.sum[n.field]=0),r=Number(r),E(!Number.isNaN(r),"Can't compute aggregate function "+n.name+"("+n.field+") because some values are not numbers."),o.aggr.total[n.field]+=1,o.aggr.sum[n.field]+=r);break;case"MIN":E(t||"string"==typeof r,"Aggregate function MIN("+n.field+") can only be performed on numbers or strings"),b(o.aggr.min,n.field)?(Number.isNaN(o.aggr.min[n.field])||(E(t,"Can't compute aggregate function MIN("+n.field+") because some values are not numbers."),r=Number(r)),r<o.aggr.min[n.field]&&(o.aggr.min[n.field]=r)):o.aggr.min[n.field]=r;break;case"MAX":E(t||"string"==typeof r,"Aggregate function MAX("+n.field+") can only be performed on numbers or strings"),b(o.aggr.max,n.field)?(Number.isNaN(o.aggr.max[n.field])||(E(t,"Can't compute aggregate function MAX("+n.field+") because some values are not numbers."),r=Number(r)),r>o.aggr.max[n.field]&&(o.aggr.max[n.field]=r)):o.aggr.max[n.field]=r}})},e=0;e<n;e++)t(e);return Object.keys(o.aggr.avg).forEach(function(n){o.aggr.avg[n]=o.aggr.sum[n]/o.aggr.total[n]}),o}function I(n){var r=[];return"*"!==n&&n.forEach(function(n){"aggr_func"===n.expr.type?(A(n.expr),r.push(n.expr)):E("column_ref"===n.expr.type,"Only field names and aggregate functions are supported in SELECT statements.")}),r}function A(n){E("COUNT"!==n.name,"Aggregate function COUNT is not yet supported."),E(o.includes(n.name),"Unknown aggregate function '"+n.name+"'."),E("string"==typeof n.field,"Unsupported type in aggregate function '"+n.name+"'.")}var x=function(n,r,t){this.name=n,this.alias=r,this.value=t},f=(Object.defineProperty(R.prototype,"ref",{get:function(){return this.e},enumerable:!0,configurable:!0}),Object.defineProperty(R.prototype,"firestore",{get:function(){return this.e.firestore},enumerable:!0,configurable:!0}),Object.defineProperty(R.prototype,"options",{get:function(){return this.v},enumerable:!0,configurable:!0}),R.prototype.query=function(t,e){return void 0===e&&(e={}),h(this,void 0,void 0,function(){var r;return d(this,function(n){if(E("string"==typeof t&&0<t.length,"query() expects a non-empty string."),"select"===(r=y(t)).type)return[2,function(u,o,i){return h(this,void 0,void 0,function(){var r,t,e;return d(this,function(n){switch(n.label){case 0:return r=new S(u,o,i),t=r.r(),[4,r.u(t)];case 1:return e=n.sent(),[2,r.i(t,e)]}})})}(this.e,r,p({},this.v,e))];throw new Error('"'+r.type.toUpperCase()+'" statements are not supported.')})})},R.prototype.toJSON=function(){return{ref:this.e,options:this.v}},R);function R(r,n){if(void 0===n&&(n={}),this.v=n,"function"==typeof r.doc)try{this.e=r.doc("/")}catch(n){this.e=r}else{if("function"!=typeof r.collection)throw new Error("The first parameter needs to be a Firestore object  or a Firestore document reference .");this.e=r}}function C(n){try{return!!n()}catch(n){return!0}}function _(n){return B(function(n){if(null==n)throw TypeError("Can't call method on "+n);return n}(n))}function j(n){return isNaN(n=+n)?0:(0<n?q:G)(n)}function L(s){return function(n,r,t){var e,u,o,i,f=_(n),c=0<(i=f.length)?Y(j(i),9007199254740991):0,a=(u=c,(o=j(t))<0?X(o+u,0):K(o,u));if(s&&r!=r){for(;a<c;)if((e=f[a++])!=e)return!0}else for(;a<c;a++)if((s||a in f)&&f[a]===r)return s||a||0;return!s&&-1}}function U(n,r){return{enumerable:!(1&n),configurable:!(2&n),writable:!(4&n),value:r}}function F(n){return"object"==typeof n?null!==n:"function"==typeof n}function M(n,r){if(!F(n))return n;var t,e;if(r&&"function"==typeof(t=n.toString)&&!F(e=t.call(n)))return e;if("function"==typeof(t=n.valueOf)&&!F(e=t.call(n)))return e;if(!r&&"function"==typeof(t=n.toString)&&!F(e=t.call(n)))return e;throw TypeError("Can't convert object to primitive value")}function W(n,r){return J.call(n,r)}function k(n){return rn?nn.createElement(n):{}}function D(n){if(!F(n))throw TypeError(String(n)+" is not an object");return n}f.prototype.rxQuery=function(n,r){E("string"==typeof n&&0<n.length,"rxQuery() expects a non-empty string.");var t,e,u,c,a,o,i,f=y(n);return E("select"===f.type,"Only SELECT statements are supported."),t=this.e,e=f,u=p({},this.v,r),o=new S(t,e,u),i=o.r(),e.n&&(E("select"===e.n.type," UNION statements are only supported between SELECTs."),i=i.concat(o.r(e.n))),a=!0===o.o?(c=g,!0):"string"==typeof o.o?(c=o.o,!0):!(c=g),s.combineLatest(i.map(function(n){return v.collectionData(n,c)})).pipe(l.map(function(n){for(var r=[],t={},e=0,u=n;e<u.length;e++)for(var o=0,i=u[e];o<i.length;o++){var f=i[o];b(t,f[c])||(t[f[c]]=!0,a||delete f[c],r.push(f))}return r}),l.map(function(n){return o.i(i,n)}))};var H={}.toString,P="".split,B=C(function(){return!Object("z").propertyIsEnumerable(0)})?function(n){return"String"==(r=n,H.call(r).slice(8,-1))?P.call(n,""):Object(n);var r}:Object,G=Math.ceil,q=Math.floor,Y=Math.min,X=Math.max,K=Math.min,z="object"==typeof window&&window&&window.Math==Math?window:"object"==typeof self&&self&&self.Math==Math?self:Function("return this")(),V=!C(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a}),Z={}.propertyIsEnumerable,Q=Object.getOwnPropertyDescriptor,$={f:Q&&!Z.call({1:2},1)?function(n){var r=Q(this,n);return!!r&&r.enumerable}:Z},J={}.hasOwnProperty,nn=z.document,rn=F(nn)&&F(nn.createElement),tn=!V&&!C(function(){return 7!=Object.defineProperty(k("div"),"a",{get:function(){return 7}}).a}),en=Object.getOwnPropertyDescriptor,un={f:V?en:function(n,r){if(n=_(n),r=M(r,!0),tn)try{return en(n,r)}catch(n){}if(W(n,r))return U(!$.f.call(n,r),n[r])}},on=Object.defineProperty,fn={f:V?on:function(n,r,t){if(D(n),r=M(r,!0),D(t),tn)try{return on(n,r,t)}catch(n){}if("get"in t||"set"in t)throw TypeError("Accessors not supported");return"value"in t&&(n[r]=t.value),n}},cn=V?function(n,r,t){return fn.f(n,r,U(1,t))}:function(n,r,t){return n[r]=t,n};function an(n,r){return n(r={exports:{}},r.exports),r.exports}function sn(r,t){try{cn(z,r,t)}catch(n){z[r]=t}return t}function ln(n){return"Symbol(".concat(void 0===n?"":n,")_",(++mn+wn).toString(36))}function vn(n){return Nn[n]||(Nn[n]=ln(n))}var pn,hn,dn,yn=an(function(n){var r="__core-js_shared__",t=z[r]||sn(r,{});(n.exports=function(n,r){return t[n]||(t[n]=void 0!==r?r:{})})("versions",[]).push({version:"3.0.1",mode:"global",copyright:"© 2019 Denis Pushkarev (zloirock.ru)"})}),gn=yn("native-function-to-string",Function.toString),En=z.WeakMap,bn="function"==typeof En&&/native code/.test(gn.call(En)),mn=0,wn=Math.random(),Nn=yn("keys"),On={},Sn=z.WeakMap;if(bn){var Tn=new Sn,In=Tn.get,An=Tn.has,xn=Tn.set;pn=function(n,r){return xn.call(Tn,n,r),r},hn=function(n){return In.call(Tn,n)||{}},dn=function(n){return An.call(Tn,n)}}else{var Rn=vn("state");On[Rn]=!0,pn=function(n,r){return cn(n,Rn,r),r},hn=function(n){return W(n,Rn)?n[Rn]:{}},dn=function(n){return W(n,Rn)}}function Cn(n,r){var t,e=_(n),u=0,o=[];for(t in e)!W(On,t)&&W(e,t)&&o.push(t);for(;r.length>u;)W(e,t=r[u++])&&(~Wn(o,t)||o.push(t));return o}function _n(n,r){for(var t=Gn(r),e=fn.f,u=un.f,o=0;o<t.length;o++){var i=t[o];W(n,i)||e(n,i,u(r,i))}}function jn(n,r){var t=Xn[Yn(n)];return t==zn||t!=Kn&&("function"==typeof r?C(r):!!r)}function Ln(n,r){var t,e,u,o,i,f=n.target,c=n.global,a=n.stat;if(t=c?z:a?z[f]||sn(f,{}):(z[f]||{}).prototype)for(e in r){if(o=r[e],u=n.noTargetGet?(i=Zn(t,e))&&i.value:t[e],!Vn(c?e:f+(a?".":"#")+e,n.forced)&&void 0!==u){if(typeof o==typeof u)continue;_n(o,u)}(n.sham||u&&u.sham)&&cn(o,"sham",!0),Mn(t,e,o,n)}}function Un(){}var Fn={set:pn,get:hn,has:dn,enforce:function(n){return dn(n)?hn(n):pn(n,{})},getterFor:function(t){return function(n){var r;if(!F(n)||(r=hn(n)).type!==t)throw TypeError("Incompatible receiver, "+t+" required");return r}}},Mn=an(function(n){var r=Fn.get,f=Fn.enforce,c=String(gn).split("toString");yn("inspectSource",function(n){return gn.call(n)}),(n.exports=function(n,r,t,e){var u=!!e&&!!e.unsafe,o=!!e&&!!e.enumerable,i=!!e&&!!e.noTargetGet;"function"==typeof t&&("string"!=typeof r||W(t,"name")||cn(t,"name",r),f(t).source=c.join("string"==typeof r?r:"")),n!==z?(u?!i&&n[r]&&(o=!0):delete n[r],o?n[r]=t:cn(n,r,t)):o?n[r]=t:sn(r,t)})(Function.prototype,"toString",function(){return"function"==typeof this&&r(this).source||gn.call(this)})}),Wn=L(!1),kn=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],Dn=kn.concat("length","prototype"),Hn={f:Object.getOwnPropertyNames||function(n){return Cn(n,Dn)}},Pn={f:Object.getOwnPropertySymbols},Bn=z.Reflect,Gn=Bn&&Bn.ownKeys||function(n){var r=Hn.f(D(n)),t=Pn.f;return t?r.concat(t(n)):r},qn=/#|\.prototype\./,Yn=jn.normalize=function(n){return String(n).replace(qn,".").toLowerCase()},Xn=jn.data={},Kn=jn.NATIVE="N",zn=jn.POLYFILL="P",Vn=jn,Zn=un.f,Qn=!C(function(){return!String(Symbol())}),$n=yn("wks"),Jn=z.Symbol,nr=Object.keys||function(n){return Cn(n,kn)},rr=V?Object.defineProperties:function(n,r){D(n);for(var t,e=nr(r),u=e.length,o=0;o<u;)fn.f(n,t=e[o++],r[t]);return n},tr=z.document,er=tr&&tr.documentElement,ur=vn("IE_PROTO"),or="prototype",ir=function(){var n,r=k("iframe"),t=kn.length;for(r.style.display="none",er.appendChild(r),r.src=String("javascript:"),(n=r.contentWindow.document).open(),n.write("<script>document.F=Object<\/script>"),n.close(),ir=n.F;t--;)delete ir[or][kn[t]];return ir()},fr=Object.create||function(n,r){var t;return null!==n?(Un[or]=D(n),t=new Un,Un[or]=null,t[ur]=n):t=ir(),void 0===r?t:rr(t,r)};On[ur]=!0;var cr,ar=$n[cr="unscopables"]||($n[cr]=Qn&&Jn[cr]||(Qn?Jn:ln)("Symbol."+cr)),sr=Array.prototype;null==sr[ar]&&cn(sr,ar,fr(null));var lr,vr=L(!0);Ln({target:"Array",proto:!0},{includes:function(n){return vr(this,n,1<arguments.length?arguments[1]:void 0)}}),sr[ar].includes=!0,lr=Function.call,z.Array.prototype.includes,function(n){if("function"!=typeof lr)throw TypeError(String(lr)+" is not a function")}(),Ln({target:"Number",stat:!0},{isNaN:function(n){return n!=n}}),z.Number.isNaN,n.FireSQL=f,Object.defineProperty(n,"p",{value:!0})});var FireSQL="undefined"!=typeof firesql&&firesql.FireSQL;
//# sourceMappingURL=firesql.umd.js.map
